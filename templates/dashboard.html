<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chameleon | AI-Powered API Honeypot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container-fluid px-4 py-3">
        <header class="mb-4">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <div class="logo-icon me-3">
                        <span class="cyber-icon">&lt;/&gt;</span>
                    </div>
                    <div>
                        <h1 class="mb-0 glow-text">CHAMELEON</h1>
                        <p class="tagline mb-0">AI-Powered API Honeypot</p>
                    </div>
                </div>
                <div class="status-indicator">
                    <span class="pulse"></span>
                    <span class="status-text">ACTIVE</span>
                </div>
            </div>
        </header>

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            <path d="M12 8v4"/>
                            <path d="M12 16h.01"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total Attacks Captured</div>
                        <div class="stat-value" id="totalAttacks">0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Most Attacked Endpoint</div>
                        <div class="stat-value endpoint-value" id="mostAttacked">N/A</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Endpoint Hit Count</div>
                        <div class="stat-value" id="hitCount">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h2 class="mb-0">
                    <span class="terminal-prompt">&gt;</span> Attack Log Feed
                </h2>
                <div class="refresh-indicator">
                    <span class="refresh-dot"></span>
                    <span>Auto-refresh: 2s</span>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-dark cyber-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>IP Address</th>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>AI Response Preview</th>
                        </tr>
                    </thead>
                    <tbody id="logsTableBody">
                        <tr class="empty-state">
                            <td colspan="5" class="text-center py-5">
                                <div class="waiting-animation">
                                    <span class="dot"></span>
                                    <span class="dot"></span>
                                    <span class="dot"></span>
                                </div>
                                <p class="mt-3">Waiting for incoming attacks...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <footer class="mt-4 text-center">
            <p class="footer-text">Chameleon Honeypot v1.0 | Powered by Google Gemini AI</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function getMethodBadgeClass(method) {
            const classes = {
                'GET': 'badge-get',
                'POST': 'badge-post',
                'PUT': 'badge-put',
                'DELETE': 'badge-delete'
            };
            return classes[method] || 'badge-default';
        }

        function truncateText(text, maxLength) {
            if (!text) return 'N/A';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateDashboard() {
            fetch('/api/logs')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('totalAttacks').textContent = data.stats.total_attacks;
                    document.getElementById('mostAttacked').textContent = data.stats.most_attacked_endpoint || 'N/A';
                    document.getElementById('hitCount').textContent = data.stats.most_attacked_count || 0;

                    const tbody = document.getElementById('logsTableBody');
                    
                    if (data.logs.length === 0) {
                        tbody.innerHTML = `
                            <tr class="empty-state">
                                <td colspan="5" class="text-center py-5">
                                    <div class="waiting-animation">
                                        <span class="dot"></span>
                                        <span class="dot"></span>
                                        <span class="dot"></span>
                                    </div>
                                    <p class="mt-3">Waiting for incoming attacks...</p>
                                </td>
                            </tr>
                        `;
                        return;
                    }

                    tbody.innerHTML = data.logs.map(log => `
                        <tr class="log-row">
                            <td class="timestamp-cell">${escapeHtml(log.timestamp)}</td>
                            <td class="ip-cell">${escapeHtml(log.ip_address)}</td>
                            <td><span class="method-badge ${getMethodBadgeClass(log.request_method)}">${escapeHtml(log.request_method)}</span></td>
                            <td class="endpoint-cell">${escapeHtml(log.endpoint)}</td>
                            <td class="response-cell">
                                <code class="response-preview">${escapeHtml(truncateText(log.ai_response_sent, 80))}</code>
                            </td>
                        </tr>
                    `).join('');
                })
                .catch(error => {
                    console.error('Error fetching logs:', error);
                });
        }

        updateDashboard();
        setInterval(updateDashboard, 2000);
    </script>
</body>
</html>
